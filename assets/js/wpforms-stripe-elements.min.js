"use strict";var WPFormsStripeElements=window.WPFormsStripeElements||function(e,t,s){var d={stripe:null,lockedPageToSwitch:0,init:function(){d.stripe=Stripe(wpforms_stripe.publishable_key,{locale:wpforms_stripe.data.element_locale}),s(e).on("wpformsReady",function(){s(".wpforms-stripe form").each(d.setupStripeForm)}),s(e).on("wpformsBeforePageChange",d.pageChange)},setupStripeForm:function(){var e=s(this);d.updateFormSubmitHandler(e),e.on("wpformsAjaxSubmitActionRequired",d.handleCardActionCallback),d.updateCardElementStylesModern(e)},setupCardElement:function(r,i){const a=r.find(".wpforms-stripe-credit-card-hidden-input");var e,t;if(a&&0!==a.length)return(t=a.data("stripe-element"))||(e=wpforms_stripe.data.element_style,s.isEmptyObject(e)&&(e=d.getElementStyleDefault(a)),e={classes:wpforms_stripe.data.element_classes,hidePostalCode:!0,style:e},(t=d.stripe.elements().create("card",e)).mount(r.find(".wpforms-field-stripe-credit-card-cardnumber").get(0)),t.on("change",function(e){var t;e.error?(t=e.error.message,"incomplete_number"!==e.error.code&&"invalid_number"!==e.error.code||(t=wpforms_settings.val_creditcard),d.displayStripeError(r,t)):i.hideThese(i.errorsFor(a.get(0)))}),a.data("stripe-element",t)),t},getElementStyleDefault:function(t){if(t&&0!==t.length){var r=t.css("color"),i=t.css("font-size"),r={base:{fontSize:i,color:r,"::placeholder":{fontSize:i}}};let e=t.css("font-family");i=/[“”<>!@$%^&*=~`|{}[\]]/;return!i.test(e)&&-1===e.indexOf("MS Shell Dlg")||(e=s("p").css("font-family")),i.test(e)||(r.base.fontFamily=e,r.base["::placeholder"].fontFamily=e),r}},updateFormSubmitHandler:function(a){var e=a.validate(),s=e.settings.submitHandler,n=d.setupCardElement(a,e),o=a.find(".wpforms-field-stripe-credit-card-cardnumber");e.settings.submitHandler=function(){var e=a.validate().form(),t=o.hasClass(wpforms_stripe.data.element_classes.empty),r=o.data("required"),i=o.closest(".wpforms-field-stripe-credit-card").hasClass("wpforms-conditional-hide");if(e&&(i?!1:r||!t&&!r))a.find(".wpforms-submit").prop("disabled",!0),d.createPaymentMethod(a,n,r,s);else{if(e)return a.find(".wpforms-submit").prop("disabled",!1),s(a);a.find(".wpforms-submit").prop("disabled",!1),a.validate().cancelSubmit=!0}}},createPaymentMethod:function(t,e,r,i){d.stripe.createPaymentMethod("card",e,{billing_details:{name:t.find(".wpforms-field-stripe-credit-card-cardname").val()}}).then(function(e){e.error&&r?(t.find(".wpforms-submit").prop("disabled",!1),d.displayStripeError(t,e.error.message),t.validate().cancelSubmit=!0):(e.error||(t.find(".wpforms-stripe-payment-method-id").remove(),e.paymentMethod&&t.append('<input type="hidden" class="wpforms-stripe-payment-method-id" name="wpforms[payment_method_id]" value="'+e.paymentMethod.id+'">')),i(t))})},handleCardActionCallback:function(e,t){var r=s(this);t.success&&t.data.action_required&&d.stripe.handleCardPayment(t.data.payment_intent_client_secret).then(function(e){d.handleCardPaymentCallback(r,e)})},handleCardPaymentCallback:function(e,t){t.error?(d.formAjaxUnblock(e),e.find(".wpforms-field-stripe-credit-card-cardnumber").addClass(wpforms_stripe.data.element_classes.invalid),d.displayStripeError(e,t.error.message)):t.paymentIntent&&"succeeded"===t.paymentIntent.status?(e.find(".wpforms-stripe-payment-method-id").remove(),e.find(".wpforms-stripe-payment-intent-id").remove(),e.append('<input type="hidden" class="wpforms-stripe-payment-intent-id" name="wpforms[payment_intent_id]" value="'+t.paymentIntent.id+'">'),wpforms.formSubmitAjax(e)):d.formAjaxUnblock(e)},displayStripeError:function(e,t){var r=e.find(".wpforms-stripe-credit-card-hidden-input").attr("name"),i=e.find(".wpforms-field-stripe-credit-card-cardnumber"),a={};a[r]=t,wpforms.displayFormAjaxFieldErrors(e,a),wpforms.scrollToError(i)},formAjaxUnblock:function(e){var t=e.closest(".wpforms-container"),r=e.find(".wpforms-submit-spinner"),e=e.find(".wpforms-submit"),i=e.data("submit-text");i&&e.text(i),e.prop("disabled",!1),t.css("opacity",""),r.hide()},pageChange:function(e,t,r,i){var a=r.find(".wpforms-field-stripe-credit-card-cardnumber"),s=a.hasClass(wpforms_stripe.data.element_classes.complete),n=a.hasClass(wpforms_stripe.data.element_classes.empty),o=a.hasClass(wpforms_stripe.data.element_classes.invalid);!a.is(":visible")||!a.data("required")&&n||d.lockedPageToSwitch&&d.lockedPageToSwitch!==t||"prev"===i||(s?a.find(".wpforms-error").remove():(d.lockedPageToSwitch=t,e.preventDefault(),o||d.displayStripeError(r,wpforms_stripe.i18n.empty_details)))},updateCardElementStylesModern:function(e){if(t.WPForms&&WPForms.FrontendModern&&e&&0!==e.length){let r=WPForms.FrontendModern.getCssVars(e);e.find(".wpforms-stripe-credit-card-hidden-input").each(function(){var e,t=s(this).data("stripe-element");t&&(e={base:{color:r["field-text-color"],fontSize:r["field-size-font-size"],"::placeholder":{color:WPForms.FrontendModern.getColorWithOpacity(r["field-text-color"],"0.5"),fontSize:r["field-size-font-size"]}},invalid:{color:r["field-text-color"]}},t.update({style:e}))})}}};return d}(document,window,jQuery);WPFormsStripeElements.init();