"use strict";var WPFormsStripeElements=window.WPFormsStripeElements||function(e,s){var o={stripe:null,lockedPageToSwitch:0,init:function(){o.stripe=Stripe(wpforms_stripe.publishable_key,{locale:wpforms_stripe.data.element_locale}),s(e).on("wpformsReady",function(){s(".wpforms-stripe form").each(o.setupStripeForm)}),s(e).on("wpformsBeforePageChange",o.pageChange)},setupStripeForm:function(){var e=s(this);o.updateFormSubmitHandler(e),e.on("wpformsAjaxSubmitActionRequired",o.handleCardActionCallback)},setupCardElement:function(r,a){var i=r.find(".wpforms-stripe-credit-card-hidden-input"),e=wpforms_stripe.data.element_style,e=(s.isEmptyObject(e)&&(e=o.getElementStyleDefault(i)),{classes:wpforms_stripe.data.element_classes,hidePostalCode:!0,style:e}),e=o.stripe.elements().create("card",e);return e.mount(r.find(".wpforms-field-stripe-credit-card-cardnumber").get(0)),e.on("change",function(e){var t;e.error?(t=e.error.message,"incomplete_number"!==e.error.code&&"invalid_number"!==e.error.code||(t=wpforms_settings.val_creditcard),o.displayStripeError(r,t)):a.hideThese(a.errorsFor(i.get(0)))}),i.data("stripe-element",e),e},getElementStyleDefault:function(e){var t={base:{fontSize:e.css("font-size"),color:e.css("color")}},e=e.css("font-family"),r=/[“”<>!@$%^&*=~`|{}[\]]/;return!r.test(e)&&-1===e.indexOf("MS Shell Dlg")||(e=s("p").css("font-family")),r.test(e)||(t.base.fontFamily=e),t},updateFormSubmitHandler:function(i){var e=i.validate(),s=e.settings.submitHandler,n=o.setupCardElement(i,e),d=i.find(".wpforms-field-stripe-credit-card-cardnumber");e.settings.submitHandler=function(){var e=i.validate().form(),t=d.hasClass(wpforms_stripe.data.element_classes.empty),r=d.data("required"),a=d.closest(".wpforms-field-stripe-credit-card").hasClass("wpforms-conditional-hide");if(e&&(a?!1:r||!t&&!r))i.find(".wpforms-submit").prop("disabled",!0),o.createPaymentMethod(i,n,r,s);else{if(e)return i.find(".wpforms-submit").prop("disabled",!1),s(i);i.find(".wpforms-submit").prop("disabled",!1),i.validate().cancelSubmit=!0}}},createPaymentMethod:function(t,e,r,a){o.stripe.createPaymentMethod("card",e,{billing_details:{name:t.find(".wpforms-field-stripe-credit-card-cardname").val()}}).then(function(e){e.error&&r?(t.find(".wpforms-submit").prop("disabled",!1),o.displayStripeError(t,e.error.message),t.validate().cancelSubmit=!0):(e.error||(t.find(".wpforms-stripe-payment-method-id").remove(),e.paymentMethod&&t.append('<input type="hidden" class="wpforms-stripe-payment-method-id" name="wpforms[payment_method_id]" value="'+e.paymentMethod.id+'">')),a(t))})},handleCardActionCallback:function(e,t){var r=s(this);t.success&&t.data.action_required&&o.stripe.handleCardPayment(t.data.payment_intent_client_secret).then(function(e){o.handleCardPaymentCallback(r,e)})},handleCardPaymentCallback:function(e,t){t.error?(o.formAjaxUnblock(e),e.find(".wpforms-field-stripe-credit-card-cardnumber").addClass(wpforms_stripe.data.element_classes.invalid),o.displayStripeError(e,t.error.message)):t.paymentIntent&&"succeeded"===t.paymentIntent.status?(e.find(".wpforms-stripe-payment-method-id").remove(),e.find(".wpforms-stripe-payment-intent-id").remove(),e.append('<input type="hidden" class="wpforms-stripe-payment-intent-id" name="wpforms[payment_intent_id]" value="'+t.paymentIntent.id+'">'),wpforms.formSubmitAjax(e)):o.formAjaxUnblock(e)},displayStripeError:function(e,t){var r={};r[e.find(".wpforms-stripe-credit-card-hidden-input").attr("name")]=t,wpforms.displayFormAjaxFieldErrors(e,r)},formAjaxUnblock:function(e){var t=e.closest(".wpforms-container"),r=e.find(".wpforms-submit-spinner"),e=e.find(".wpforms-submit"),a=e.data("submit-text");a&&e.text(a),e.prop("disabled",!1),t.css("opacity",""),r.hide()},pageChange:function(e,t,r){var a=r.find(".wpforms-field-stripe-credit-card-cardnumber"),i=a.hasClass(wpforms_stripe.data.element_classes.complete),s=a.hasClass(wpforms_stripe.data.element_classes.empty),n=a.hasClass(wpforms_stripe.data.element_classes.invalid);!a.is(":visible")||!a.data("required")&&s||o.lockedPageToSwitch&&o.lockedPageToSwitch!==t||(i?a.find(".wpforms-error").remove():(o.lockedPageToSwitch=t,e.preventDefault(),n||o.displayStripeError(r,wpforms_stripe.i18n.empty_details)))}};return o}(document,(window,jQuery));WPFormsStripeElements.init();